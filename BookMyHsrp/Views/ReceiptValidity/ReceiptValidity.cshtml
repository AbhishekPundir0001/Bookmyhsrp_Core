<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

    <!-- Place favicon.ico in the root directory -->
    <link rel="shortcut icon" type="image/x-icon" href="Images/favicon.html">
    <link rel="apple-touch-icon" href="apple-touch-icon.html">

    <!-- All css files are included here. -->
    <link rel="stylesheet" href="~/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/owl.carousel.min.css">
    <!--<link rel="stylesheet" href="assets/css/owl.theme.default.min.css"> -->
    <!-- <link rel="stylesheet" href="assets/css/owl.theme.default.min.css"> -->

</head>



    <!-- Body main wrapper start -->

    <div class="wrapper">
        <!-- Start Header Style -->
        <!-- End Header Style -->
        <!-- Start Mobile Header -->
        <!--
                <div class="mobile-header d-block d-lg-none">
                    <div class="container">
                        <div class="row align-items-center justify-content-between">

                        </div>
                    </div>
                </div>
        -->
        <!-- End Mobile Header -->
        <!--  Start Offcanvas Mobile Menu Section  -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="toggleMenu">
            <div class="offcanvas-header">

                <!-- Start Header Logo -->
                <a href="index-3.html" class="header-logo">
                    <img src="~/Images/logo/logo.png" alt="">
                </a>
                <!-- End Header Logo -->

                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <!-- Start Offcanvas Mobile Menu Wrapper -->
                <div class="offcanvas-mobile-menu-wrapper">
                    <!-- Start Mobile Menu  -->
                    <div class="mobile-menu-bottom">
                        <!-- Start Mobile Menu Nav -->
                        <div class="offcanvas-menu">
                            <ul>
                                <li><a href="TrackOrder.html">Track Your Order</a></li>
                                <li><a href="ReAppointment.html">Reschedule Appointment</a></li>
                                <li><a href="OrderCancel.html">Cancel Order</a></li>

                                <li><a href="PinForHomeDelivery.html">Check For Home Installation</a></li>
                                <li><a href="ReceiptValidity.html"><b>Receipt Validity</b></a></li>
                                <li><a href="BookMyHSRP_ContactUs.html"><b>Contact Us</b></a></li>
                            </ul>
                        </div>
                        <!-- End Mobile Menu Nav -->
                    </div>
                    <!-- End Mobile Menu -->
                    <!-- End Mobile contact Info -->

                </div>
                <!-- Start Mobile contact Info -->
                <!--
                    <div class="mobile-contact-info text-center">
                        <ul class="social-link">
                            <li><a href="https://example.com/"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://example.com/"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li><a href="https://example.com/"><i class="fa fa-skype"></i></a></li>
                        </ul>
                    </div>-->
                <!-- End Offcanvas Mobile Menu Wrapper -->
            </div>
        </div>
        <!--  End Offcanvas Mobile Menu Section -->

        <section class="page-header d-lg-none">
            <div class="container">
                <div class="page-header__inner text-center">
                    <h5>Step 1</h5>
                    <h2>Booking Details</h2>
                </div>
            </div>
        </section>

       
        <!-- main start -->
    <main class="main-body bg-img ptb--100 main-bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-4">
                    <div class="status-card">
                        <div class="title-area">
                            <h4 class="title">Check Receipt Validity</h4>
                        </div>
                        <div class="card-body">
                            <form action="">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label class="form-label">Vehicle Reg No.*</label>
                                            <input type="text" class="form-control" placeholder="DL01ABXXXX" id="vehicleRegNo">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="input-group">
                                            <label class="form-label w-100">Captcha</label>
                                            <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)" id="txtCaptcha" readonly>
                                            <button class="input-group-text" id="btnRefreshCaptcha"><i class="fas fa-redo-alt"></i></button>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="input-group">
                                            <label class="form-label w-100">Input Captcha</label>
                                            <input type="text" class="form-control" id= "txtInput">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                    <button type="button" class="submit-btn" id="submit-button">
                                            Search
                                        </button>
                                        <button type="button" class="submit-btn">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="status-card" id = "hidden">
                        <div class="title-area">
                            <h4 class="title">Receipt Validity Details</h4>
                        </div>
                        <div class="card-body" ">
                            <p id="validated_text"></p>
                        </div>
                   </div>
                </div>
            </div>
        </div>
    </main>
    <!-- main end -->


    </div>
    <!-- Body main wrapper end -->
    <!-- Body main Script start -->
   @section Scripts {
    <script src="~/js/owl.carousel.min.js"></script>
    <script src="~/js/main.js">
    </script>
    <script>
            


            function DrawCaptcha() {
                var a = Math.ceil(Math.random() * 9) + '';
                var b = Math.ceil(Math.random() * 9) + '';
                var c = Math.ceil(Math.random() * 9) + '';
                var d = Math.ceil(Math.random() * 9) + '';
                var code = a + ' ' + b + ' ' + c + ' ' + d;
                document.getElementById("txtCaptcha").value = code;
            }

            window.onload = function () {
                $('#hidden').hide();
                DrawCaptcha();
            document.getElementById("btnRefreshCaptcha").addEventListener("click", DrawCaptcha);
            };



            function ValidCaptcha() {
                $(this).prop('disabled', true);

                const errorFunc = (title) => {
                    Toast.fire({
                        icon: 'error',
                        title: title
                    })



                }
                var captcha = removeSpaces(document.getElementById('txtCaptcha').value);
                var inputCaptcha = removeSpaces(document.getElementById('txtInput').value);
                if (inputCaptcha == '') {
                    //alert("Captcha can't be blank!!");
                    errorFunc("Captcha can't be blank!!");
                    return;
                }
                else if (captcha == inputCaptcha) {
                    return true;
                }
                else {
                    // alert("Please Input Correct Captcha");
                    errorFunc("Please Input Correct Captcha");
                    return;
                }
            }
            function removeSpaces(string) {
                return string.split(' ').join('');
            }

            function removeSpaces(string) {
                return string.replace(/\s+/g, '');
            }
        

            $('#submit-button').click(function () {
                handleButtonClick.call(this, '/receipt-validaity', postData, (result) => {
                    // bindHtmlHsrpView(result.Data);
                    // $('#div-bind-report').show();
                    // console.log('Data posted successfully, where the server response data is', result);
                })
            });

      
        async function handleButtonClick(url, postData, isSuccessFunc) { 
                
                const errorFunc = (title) => {
                    Toast.fire({
                        icon: 'error',
                        title: title
                    })
                    $(this).prop('disabled', false);

                }
                var vehRegNo = $('#vehicleRegNo').val();
                if (!vehRegNo)
                {
                    errorFunc('Please Insert Registration No.')
                    
                }
                if (!ValidCaptcha()) {
                    $(this).prop('disabled', false);
                    $(this).html(originalButtonText)
                    return false;
                }

                var data = { VehicleregNo: vehRegNo }
                const result = await postData(url, data);
                
                if (result == null || result.Count == 0) {
                    $('.status-card').hide();
                    const text = "Record not found"
                    $('#validated_text').text(text);
                    $('#hidden').show();
                }
                else if (result[0].daycount <= 15) {
                    $('.status-card').hide();
                    const text = "The Validity of your receipt is " + result[0].ExpireDate + " of Vehicle No  " + result[0].VehicleRegNo;
                    $('#validated_text').text(text);
                    $('#hidden').show();
                }
                else{
                    $('.status-card').hide();
                    const text = "Record not found"
                    $('#validated_text').text(text);
                    $('#hidden').show();
                }
            }


            document.getElementById("txtInput").addEventListener("input", function (event) {

                const errorFunc = (title) => {
                    Toast.fire({
                        icon: 'error',
                        title: title
                    })
                    $(this).prop('disabled', false);

                }
                var txtInput = this.value.trim();
                console.log("txtInput:", txtInput);

                var vehicleRegNoInput = document.getElementById("vehicleRegNo");
                var vehicleRegNo = vehicleRegNoInput.value;
                console.log("vehicleRegNo:", vehicleRegNo);

                // If the user has entered exactly 4 digits and the vehicle registration number has more than 4 characters, automatically submit the form
                if (txtInput.length === 4 && !isNaN(txtInput) && vehicleRegNo.length >= 6) {
                    console.log("Submitting form...");
                    document.getElementById("submit-button").click();
                }
                if (txtInput.length === 4 && !vehicleRegNo) {
                    errorFunc('Please Insert Registration No.');
                }
                else if (txtInput.length === 4 && vehicleRegNo.length <= 5) {
                    console.log("Showing error message...");
                    errorFunc('Please Provide Correct Registration No.');
                }
            });

    </script>

   }
    <!-- Body main Script end -->

</html>






