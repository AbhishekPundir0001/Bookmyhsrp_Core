<html>


<head>
 
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">

        <!-- Place favicon.ico in the root directory -->
        <link rel="shortcut icon" type="image/x-icon" href="Images/favicon.html">
        <link rel="apple-touch-icon" href="apple-touch-icon.html">

        <!-- All css files are included here. -->
        <link rel="stylesheet" href="~/css/bootstrap.min.css">
        <link rel="stylesheet" href="~/css/style.css">
        <link rel="stylesheet" href="~/css/owl.carousel.min.css">
        <!--     <link rel="stylesheet" href="assets/css/owl.theme.default.min.css"> -->

  z
    <!--     <link rel="stylesheet" href="assets/css/owl.theme.default.min.css"> -->

</head>

<body>

        <!-- main start -->
        <main class="main-body bg-img ptb--50 main-bg">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-4">
                        <div class="status-card">
                            <div class="title-area">
                                <h4 class="title">Reschedule Your Appointment</h4>
                            </div>
                            <div class="card-body">
                                <form action="">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label class="form-label">Order number*</label>
                                            <input type="text" class="form-control" placeholder="DLHSRP1221XXXXXX" id="orderNo">
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label class="form-label">Vehicle Reg No.*</label>
                                                <input type="text" class="form-control" placeholder="DL01ABXXXX" id="vehregno">
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="input-group">
                                                <label class="form-label w-100">Captcha</label>
                                            <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)" id="txtCaptcha">
                                            <button class="input-group-text"><i class="fas fa-redo-alt" id="btnRefreshCaptcha"></i></button>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="input-group">
                                                <label class="form-label w-100">Input Captcha</label>
                                            <input type="text" class="form-control" id="txtInput">
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <button type="button" class="submit-btn" id="submit-btn">
                                                Search
                                            </button>
                                            <button type="button" class="submit-btn">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    <div class="modal otp-modal fade" id="otp-modal" data-bs-backdrop="static" data-bs-keyboard="false"
         tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Order booking verification</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body text-center">
                    <div class="position-relative">
                        <div class="img-icon">
                            <img src="~/Images/password.png" alt="">
                        </div>
                        <h6>Please enter the OTP send to your<br>registerd mobile number</h6>
                        <span>OTP is valid for 10 minutes. </span>
                        <div class="otp-box">
                            <form action="#">
                                <div class="input-field">
                                    <input id="first" type="number" class="otp-text m-2" />
                                    <input id="second" type="number" class="otp-text m-2" disabled />
                                    <input id="third" type="number" class="otp-text m-2" disabled />
                                    <input id="fourth" type="number" class="otp-text m-2" disabled />
                                </div>
                                <div class="mt-3">
                                    <button id="btn-validate" class="submit-btn otp-btn"
                                            data-bs-dismiss="modal">
                                        Validate
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div class="card-2">
                            <p class="resend-para">
                                Didn't receive OTP? <a href="#"
                                                       class="text-decoration-none ms-1">Resend</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @section Scripts {
        <script>



            function DrawCaptcha() {
                var a = Math.ceil(Math.random() * 9) + '';
                var b = Math.ceil(Math.random() * 9) + '';
                var c = Math.ceil(Math.random() * 9) + '';
                var d = Math.ceil(Math.random() * 9) + '';
                var code = a + ' ' + b + ' ' + c + ' ' + d;
                document.getElementById("txtCaptcha").value = code;
            }

            window.onload = function () {

                DrawCaptcha();
                document.getElementById("btnRefreshCaptcha").addEventListener("click", DrawCaptcha);
         

            };



            $('#btn-validate').click(async function () {
                const validateBtn = document.querySelector('.otp-btn');
                $(this).prop('disabled', true);
                var originalButtonText = $(this).html();

                const errorFunc = (title) => {
                    Toast.fire({
                        icon: 'error',
                        title: title
                    })
                    $(this).prop('disabled', false);
                    $(this).html(originalButtonText);

                }
                // Add click event listener to the "Validate" button
                // validateBtn.addEventListener('click', function (event) {
                //     event.preventDefault(); // Prevent form submission

                // Get the OTP input elements
                const firstInput = document.getElementById('first');
                const secondInput = document.getElementById('second');
                const thirdInput = document.getElementById('third');
                const fourthInput = document.getElementById('fourth');

                // Get the values of the OTP inputs
                const firstValue = firstInput.value;
                const secondValue = secondInput.value;
                const thirdValue = thirdInput.value;
                const fourthValue = fourthInput.value;

                // Concatenate the OTP values into a single string
                const otp = firstValue + secondValue + thirdValue + fourthValue;
                if (otp != "") {
                    let url = "/api/v1/otp/otpConfirmation/" + otp;
                    const result = await fetchData(url);
                    if (result.Message == "Data Received.") {
                        window.location.href = "/reappointmentslot";
                    }
                    else {
                        errorFunc("Wrong Otp");
                        return;
                    }

                }

                // Now, the 'otp' variable contains the concatenated OTP value
                //      console.log(otp);

                // You can perform further actions with the OTP value here, such as validation or sending it to a server.
                //});

            });




            const inputs = document.querySelectorAll(".otp-text");

            // iterate over all inputs
            inputs.forEach((input, index1) => {
                input.addEventListener("keyup", (e) => {
                    // This code gets the current input element and stores it in the currentInput variable
                    // This code gets the next sibling element of the current input element and stores it in the nextInput variable
                    // This code gets the previous sibling element of the current input element and stores it in the prevInput variable
                    const currentInput = input,
                        nextInput = input.nextElementSibling,
                        prevInput = input.previousElementSibling;

                    // if the value has more than one character then clear it
                    if (currentInput.value.length > 1) {
                        currentInput.value = "";
                        return;
                    }
                    // if the next input is disabled and the current value is not empty
                    //  enable the next input and focus on it
                    if (nextInput && nextInput.hasAttribute("disabled") && currentInput.value !== "") {
                        nextInput.removeAttribute("disabled");
                        nextInput.focus();
                    }

                    // if the backspace key is pressed
                    if (e.key === "Backspace") {
                        // iterate over all inputs again
                        inputs.forEach((input, index2) => {
                            // if the index1 of the current input is less than or equal to the index2 of the input in the outer loop
                            // and the previous element exists, set the disabled attribute on the input and focus on the previous element
                            if (index1 <= index2 && prevInput) {
                                input.setAttribute("disabled", true);
                                input.value = "";
                                prevInput.focus();
                            }
                        });
                    }
                    //if the fourth input( which index number is 3) is not empty and has not disable attribute then
                    //add active class if not then remove the active class.
                    if (!inputs[3].disabled && inputs[3].value !== "") {
                        //  button.classList.add("active");
                        return;
                    }
                    // button.classList.remove("active");
                });
            });

            //focus the first input which index is 0 on window load
            // window.addEventListener("load", () => inputs[0].focus());



            function ValidCaptcha() {
                $(this).prop('disabled', true);

                const errorFunc = (title) => {
                    Toast.fire({
                        icon: 'error',
                        title: title
                    })



                }
                var captcha = removeSpaces(document.getElementById('txtCaptcha').value);
                var inputCaptcha = removeSpaces(document.getElementById('txtInput').value);
                if (inputCaptcha == '') {
                    //alert("Captcha can't be blank!!");
                    errorFunc("Captcha can't be blank!!");
                    return;
                }
                else if (captcha == inputCaptcha) {
                    return true;
                }
                else {
                    // alert("Please Input Correct Captcha");
                    errorFunc("Please Input Correct Captcha");
                    return;
                }
            }
            function removeSpaces(string) {
                return string.split(' ').join('');
            }

            function removeSpaces(string) {
                return string.replace(/\s+/g, '');
            }


            $('#submit-btn').click(function () {
                handleButtonClick.call(this, '/reappointment-details', postData, (result) => {
                    // bindHtmlHsrpView(result.Data);
                    // $('#div-bind-report').show();
                    // console.log('Data posted successfully, where the server response data is', result);
                })
            });




            async function handleButtonClick(url, postData, isSuccessFunc) {
                debugger
                const errorFunc = (title) => {
                    Toast.fire({
                        icon: 'error',
                        title: title
                    })
                    $(this).prop('disabled', false);

                }
                var vehRegNo = $('#vehregno').val();
                var orderNo = $('#orderNo').val();
                if (!vehRegNo) {
                    errorFunc('Please Insert Registration No.')
                }
                if (!ValidCaptcha()) {
                    $(this).prop('disabled', false);
                    $(this).html(originalButtonText)
                    return false;
                }

                var data = { VehicleregNo: vehRegNo, OrderNo: orderNo }
                const result = await postData(url, data);
                debugger
                if (result.Status === "1") {
                    $('#otp-modal').modal('show');
                    let url = "reappointmentOTP";
                    const otpresult = await postData(url, data);
                    return otpresult;

                }
              
            }


        </script>

    }

</body>

</html>
