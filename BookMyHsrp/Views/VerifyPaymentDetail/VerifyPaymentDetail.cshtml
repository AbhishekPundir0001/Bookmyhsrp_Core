<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Dreams Rent | Template</title>

    <!-- Place favicon.ico in the root directory -->
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.html">
    <link rel="apple-touch-icon" href="apple-touch-icon.html">

    <!-- All css files are included here. -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <!--     <link rel="stylesheet" href="assets/css/owl.theme.default.min.css"> -->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.1.4/dist/css/datepicker.min.css">-->
    <link rel="stylesheet" href="assets/css/calender.css">



</head>

<body>

    <!-- Body main wrapper start -->

    <div class="wrapper">
        <!-- Start Header Style -->
        <!-- End Header Style -->
        <!-- Start Mobile Header -->
        <!--
                <div class="mobile-header d-block d-lg-none">
                    <div class="container">
                        <div class="row align-items-center justify-content-between">

                        </div>
                    </div>
                </div>
        -->
        <!-- End Mobile Header -->
        <!--  Start Offcanvas Mobile Menu Section  -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="toggleMenu">
            <div class="offcanvas-header">

                <!-- Start Header Logo -->
                <a href="index-3.html" class="header-logo">
                    <img src="assets/images/logo/logo.png" alt="">
                </a>
                <!-- End Header Logo -->

                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <!-- Start Offcanvas Mobile Menu Wrapper -->
                <div class="offcanvas-mobile-menu-wrapper">
                    <!-- Start Mobile Menu  -->
                    <div class="mobile-menu-bottom">
                        <!-- Start Mobile Menu Nav -->
                        <div class="offcanvas-menu">
                            <ul>
                                <li><a href="TrackOrder.html">Track Your Order</a></li>
                                <li><a href="ReAppointment.html">Reschedule Appointment</a></li>
                                <li><a href="OrderCancel.html">Cancel Order</a></li>

                                <li><a href="PinForHomeDelivery.html">Check For Home Installation</a></li>
                                <li><a href="ReceiptValidity.html"><b>Receipt Validity</b></a></li>
                                <li><a href="BookMyHSRP_ContactUs.html"><b>Contact Us</b></a></li>
                            </ul>
                        </div>
                        <!-- End Mobile Menu Nav -->
                    </div>
                    <!-- End Mobile Menu -->
                    <!-- End Mobile contact Info -->

                </div>
                <!-- Start Mobile contact Info -->
                <!--
                    <div class="mobile-contact-info text-center">
                        <ul class="social-link">
                            <li><a href="https://example.com/"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://example.com/"><i class="fa fa-twitter"></i></a>
                            </li>
                            <li><a href="https://example.com/"><i class="fa fa-skype"></i></a></li>
                        </ul>
                    </div>-->
                <!-- End Offcanvas Mobile Menu Wrapper -->
            </div>
        </div>
        <section class="page-header d-lg-none">
            <div class="container">
                <div class="page-header__inner text-center">
                    <h5>Step 5</h5>
                    <h2>Verify Details & Pay</h2>
                </div>
            </div>
        </section>

        <!-- main start -->
        <main class="main-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 col-lg-3 p-0 order-2 order-lg-1">
                        <div class="sidebar">
                            <div class="side-steper d-none d-lg-block">
                                <ul class="side-ul">
                                    <li class="active">Step -1 Booking Details</li>
                                    <li class="active">Step -2 Fitment Location</li>
                                    <li class="active">Step -3 Appointment Slot</li>
                                    <li class="active">Step -4 Booking Summary</li>
                                    <li class="active">Step -5 Verify Details & Pay</li>
                                    <li>Step -6 Download Receipt</li>
                                </ul>
                            </div>
                    <div class="side-slide">
                        <div class="owl-carousel adds-carousel owl-theme">
                            <div class="item"><img src="~/Images/adds/img-1.png" alt=""></div>
                            <div class="item"><img src="~/Images/adds/img-2.png" alt=""></div>
                            <div class="item"><img src="~/Images/adds/img-3.png" alt=""></div>
                            <div class="item"><img src="~/Images/adds/img-4.png" alt=""></div>
                            <div class="item"><img src="~/Images/adds/img-5.png" alt=""></div>
                            <div class="item"><img src="~/Images/adds/QR.jpg" alt=""></div>

                        </div>
                    </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-9 p-0 order-1 order-lg-2">
                        <div class="main-data main-bg">
                            <div class="title-area d-flex justify-content-between">
                                <h4 class="title">Verify Details & Pay</h4>
<!--                                <a href="plate-AppointmentSlot.html" class="submit-btn">Back</a>-->
                            </div>
                            <div class="row">
                                <div class="col-lg-7">
                                    <div class="booking-detail">
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="book-desc">
                                                    <label>Owner Name</label>
                                                    <p id="ownerName"></p>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="book-desc">
                                                    <label>Mobile No.</label>
                                                    <p id="mobNo"></p>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="book-desc">
                                                    <label>Billing Address</label>
                                                    <p id="address"></p>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="book-desc">
                                                    <label>Email Id</label>
                                                    <p id="email"></p>
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                               <div class="form-group">
                                            <input type="checkbox" onclick="myFunction()" id="same-d">
                                                <label for="same-c">Same as previous mobile</label>
                                                <p>Kindly ensure to update correct mobile number. All updates (SMS and OTP for the fitment) will shared over this number from time ti time.</p>
                                                </div>
                                            </div>
                                            
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                   <label>Mobile Number</label>
                                                    <input type="number" id="previousMobNo" class="form-control">
                                                    <p>Note: Kindly verify and pay HSRP fee online.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" id="display">
                                            <div class="form-group">
                                                <input type="checkbox" id="park">
                                                <label for="park">Add Park+FasTag <img src="~/Images/fastag.jpg" alt=""></label>
                                                <p style="color: #F04E37;font-size: 16px;font-weight: 600">Includes all taxes and INR 99 as tag balance for usage.</p>
                                            </div>
                                            
                                            <ul class="info-ul">
                                                <li>Park+FasTag is DIY for more instruction <a href="#">Click here...</a></li>
                                                <li>Park+FasTag = Fastag+ <img src="assets/images/park-app.png" alt=""> benefits <a href="#">Click here...</a></li>
                                            </ul>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-lg-5">
                                    <div class="payment-card">
                                        <div class="payment-head">
                                            Description
                                        </div>
                                        <div class="payment-body">
                                            <ul class="payment-ul">
                                                <li><b>HSRP Cost (Complete set) (including 3rd Sticker & Fitment Cost):</b></li>
                                                <li id="basicAmount"></li>
                                            </ul>
                                            <ul class="payment-ul">
                                                <li>Convenience Fee</li>
                                                <li id="convenienceFee"></li>
                                            </ul>
                                            <ul class="payment-ul">
                                                <li>Gross Total</li>
                                                <li id="grosstotal"></li>
                                            </ul>
                                            <ul class="payment-ul">
                                                <li id="labelcgst"> </li>
                                                <li id="cgst"></li>
                                            </ul>
                                            <ul class="payment-ul">
                                                <li id="labelsgst"> </li>
                                                <li id="sgst"></li>
                                            </ul>
                                        </div>
                                        <div class="payment-foot">
                                            <ul class="payment-ul">
                                                <li>Total Cost</li>
                                                <li id="total-cost"></li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="terms-c">
                                        <ul class="terms-ul">
                                            <li>I am the registered owner of the above mentioned vehicle.</li>
                                            <li>I confirm that above details entered by me, has been verified from the vehicle registration certificate.</li>
                                            <li>Company will not be held responsible for any wrong inputs provided by me.</li>
                                            
                                        </ul>
                                        <p>
                                            <input type="checkbox" id="cbAgree">
                                                <label for="t&c">I agree to the Terms and Condition.</label>
                                            </p>
                                    </div>
                                    <a id="rzp-button" class="submit-btn">Pay Online</a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </main>
        </div>
        <div id="popup-payment"></div>
        <!-- main end -->

  @section Scripts
  {
      <script>
        $(async function () {
               
            await GetVerifyPaymentDetail();
              $('#display').hide();
        });
          var result;
        async function GetVerifyPaymentDetail(){
           
            let url = "/getVerifyPaymentDetail";
             result = await fetchData(url);
            // $('#').val(BMHConvenienceCharges)
            // $('#').val(GrossTotal)
            $('#address').text(result.Address)
            $('#ownerName').text(result.OwnerName)
            $('#mobNo').text(result.Mobile)
            $('#email').text(result.EmailID)
                    $('#total-cost').text('Rs.' + result.TotalAmount)
                    $('#labelsgst').text("SGST 9%")
                     $('#labelcgst ').text("CGST  9%")
                     $('#labelcgst ').text("CGST  9%")
                    $('#sgst').text('Rs.' + result.SGSTAmount)
                    $('#cgst').text('Rs.' + result.CGSTAmount)
                    $('#convenienceFee').text( 'Rs.' + result.BMHConvenienceCharges)
                    $('#grosstotal').text('Rs.' + result.GrossTotal)
                    $('#basicAmount').text('Rs.' + result.GstBasic_Amt)
                    

           

        }
        function myFunction(){
 
            const checkbox = document.getElementById("same-d");
            if (checkbox.checked) {
                // Code to execute when checkbox is checked
                $('#previousMobNo').val(result.Mobile);
            } else {
                $('#previousMobNo').val('');
            }

       }
          $(document).ready(function () {
              debugger
              $('#rzp-button').click(async function (e) {
                  debugger
                  const errorFunc = (title) => {
                      Toast.fire({
                          icon: 'error',
                          title: title
                      })
                  }
                  var checkSuperTag = document.getElementById('chkSuperTag');
                  if (checkSuperTag == null) {
                      checkSuperTag = false;
                  }
                  if (checkSuperTag.checked == true) {

                      var Address1 = $("#address").val().trim().replace("\n", "");
                      var state = $("#txtShippingState").val().trim();
                      var city = $("#txtShippingCity").val().trim();
                      var pincode = $("#txtShippingPinCode").val().trim();

                      var regex = /^[a-zA-Z0-9\\// !,\$%\^\*\)\(+=._-]+$/g
                      //alert(BillingAddress);
                      //Validate TextBox value against the Regex.
                      var isValid = regex.test(Address1);

                      if (pincode == "") {
                          errorFunc("Please provide shipping pincode");
                          return;
                      } else if ((pincode.length) < 6 || (pincode.length) > 6) {

                          alert("pincode should only be 6 digits");
                          return false;
                      }

                      if (Address1 == "") {
                          alert("Please provide shipping address");
                          return false;
                      }
                      if (!isValid) {
                          alert("Some Special Characters ( # ~ & ' <>  are not Allowed ) in shipping Address");
                          return false;
                      }

                      if (city == "") {
                          alert("Please provide shipping city");
                          return false;
                      }
                      if (state == "") {
                          alert("Please provide shipping state");
                          return false;
                      }


                  }

                  var checkAgree = document.getElementById('cbAgree');

                  if (checkAgree.checked == false) {
                      errorFunc("Please check terms and condition");
                      return;
                  }
                    var txtMobileNo = $('#previousMobNo').val().trim();
                  if (txtMobileNo == '') {
                      errorFunc("Provide mobile number");
                      return;
                  }
                  if (txtMobileNo.length != 10) {
                      errorFunc("Incorrect mobile number");
                      return;
                  }
                  var payment = "payonline";
                  let data = { PaymentStatus: payment };
                  let url = '/payment'
                  const result = await postData(url, data);
                  debugger
                  if (result.Message == "Slot booked. Choose another Slot.") {
                      errorFunc("Slot booked.Choose another Slot.");
                      setTimeout(function () {
                          window.location.href = "/appointmentSlot"; // Redirect to the specified URL
                      }, 2000);



                  }
                  // Fetch data or construct dynamically
                  var order_id = result.Order_No; // Replace with server-generated order ID
                  var ownerName = result.OwnerName; // Replace with owner's name
                  var email = result.EmailID; // Replace with owner's email
                  var mobileNo = result.MobileNo; // Replace with owner's mobile number
                  var amount = parseFloat(result.NetAmount);
                  var options = {
                      "key": result.Key, // Replace with your Razorpay API key
                      "amount": Math.round(amount * 100), // Example amount (in paisa)
                      "currency": "INR",
                      "name": "Razorpay",
                      "description": "BookMyHSRP",
                      "order_id": order_id,
                      "handler": function (response) {
                          debugger
                          alert('Payment successful!');
                            console.log(response)
                            localStorage.setItem('TransactionId', response.razorpay_payment_id)
                          //localStorage.setItem('paymentId',response)
                          window.location.href = "/paymentRecipt";


                          // Handle payment success callback
                      },
                      "prefill": {
                          "name": result.OwnerName,
                          "email": result.EmailID,
                          "contact": result.MobileNo,
                      },
                      "theme": {
                          "color": "#F37254" // Example color
                      }
                  };

                  var rzp = new Razorpay(options);
                  rzp.open();
                  e.preventDefault();
              });
          });
      
    
            </script>
            <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
            <script src="https://razorpay.com/favicon.png"></script>
        <script src="https://example.com/path/to/razorpay/script.js"></script>

  }
</body>
</html>